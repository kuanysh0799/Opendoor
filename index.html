<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>OpenDoor CRM</title>
  <meta name="theme-color" content="#0c1224">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="assets/apple-touch-icon.png">
  <link rel="icon" href="assets/icon-192.png">
  <link rel="stylesheet" href="styles.css?v=15">
</head>
<body>
  <header class="appbar">
    <div class="brand">
      <img class="logo" src="assets/logo.png" alt="OpenDoor">
      <div class="titles">
        <div class="appname">OpenDoor CRM</div>
        <div class="tagline">Продажи дверей • облако • PWA</div>
      </div>
    </div>
    <div class="bar-actions">
      <button id="installBtn" class="ghost pill sm" hidden>Установить</button>
      <button id="authBtn" class="pill">Войти</button>
    </div>
  </header>

  <nav class="pill-tabs">
    <button class="pill active" data-tab="pipeline">Воронка</button>
    <button class="pill" data-tab="deals">Сделки</button>
    <button class="pill" data-tab="clients">Клиенты</button>
    <button class="pill" data-tab="reports">Отчёты</button>
  </nav>

  <main class="workspace">
    <section id="pipeline" class="pane active">
      <div id="stages" class="stages"></div>
    </section>

    <section id="deals" class="pane">
      <div class="pane-head">
        <h2>Сделки</h2>
        <input id="dealSearch" class="input" placeholder="Поиск по клиенту/телефону…" />
      </div>
      <div id="dealsList" class="cards"></div>
    </section>

    <section id="clients" class="pane">
      <div class="pane-head">
        <h2>Клиенты</h2>
        <input id="clientSearch" class="input" placeholder="Поиск по имени/телефону…" />
      </div>
      <div id="clientsList" class="cards"></div>
    </section>

    <section id="reports" class="pane">
      <div class="pane-head">
        <h2>Отчёты</h2>
        <button id="exportCsv" class="pill">Экспорт в Excel (CSV)</button>
      </div>
      <div class="empty">Нажмите «Экспорт в Excel (CSV)», чтобы скачать сделки.</div>
    </section>
  </main>

  <button id="fab" class="fab" title="Новая сделка">+</button>

  <!-- Диалог создания сделки -->
  <dialog id="dealDialog" class="dialog">
    <form method="dialog" class="sheet">
      <h3>Новая сделка</h3>
      <label>Клиент<input id="custName" class="input" placeholder="Имя клиента" required/></label>
      <label>Телефон<input id="custPhone" class="input" placeholder="+7..." /></label>
      <label>Сумма (KZT)<input id="amount" type="number" class="input" min="0" step="1000" placeholder="0"/></label>
      <menu>
        <button value="cancel" class="ghost pill">Отмена</button>
        <button id="dealSave" value="default" class="pill">Сохранить</button>
      </menu>
    </form>
  </dialog>

  <!-- Диалог карточки клиента -->
  <dialog id="clientDialog" class="dialog">
    <form method="dialog" class="sheet">
      <h3 id="clientTitle">Клиент</h3>
      <div id="clientInfo" class="client-info"></div>
      <menu>
        <a id="whatsappBtn" class="pill" target="_blank" rel="noopener">Открыть WhatsApp</a>
        <button value="cancel" class="ghost pill">Закрыть</button>
      </menu>
    </form>
  </dialog>

  <script type="module" src="firebase-config.js?v=15"></script>
  <script type="module" src="app.js?v=15"></script>
  <script>if('serviceWorker' in navigator){navigator.serviceWorker.register('./sw.js')}</script>
</body>
</html>
