<!doctype html>
<html lang="ru" data-ready="0">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no"/>
  <title>OpenDoor CRM</title>
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="apple-touch-icon" href="./apple-touch-icon.png">
  <link rel="icon" href="./icon-192.png" type="image/png">
  <meta name="theme-color" content="#0f172a">
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
<header class="od-appbar">
  <div class="od-left">
    <img src="./apple-touch-icon.png" alt="OpenDoor" class="od-logo">
    <div class="od-title">
      <div class="name">OpenDoor CRM</div>
      <div class="sub">–ü—Ä–æ–¥–∞–∂–∏ –¥–≤–µ—Ä–µ–π ¬∑ PWA</div>
    </div>
  </div>

  <div class="od-right od-auth" hidden>
    <button id="themeBtn" class="od-icon" aria-label="–¢–µ–º–∞">üåì</button>
    <div id="userChip" class="od-user hidden">
      <span id="userName">‚Äî</span>
      <button id="logoutBtn" class="od-btn od-btn--ghost">–í—ã–π—Ç–∏</button>
    </div>
    <button id="loginBtn" class="od-btn od-btn--primary">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</button>
  </div>
</header>

<nav class="od-tabs">
  <button class="od-tab od-tab--active" data-tab="funnel">–í–æ—Ä–æ–Ω–∫–∞</button>
  <button class="od-tab" data-tab="deals">–°–¥–µ–ª–∫–∏</button>
  <button class="od-tab" data-tab="clients">–ö–ª–∏–µ–Ω—Ç—ã</button>
  <button class="od-tab" data-tab="reports">–û—Ç—á—ë—Ç—ã</button>
  <button class="od-tab" data-tab="settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
</nav>

<main class="od-page">
  <!-- –í–æ—Ä–æ–Ω–∫–∞ -->
  <section id="tab-funnel" class="od-view od-view--active">
    <div class="od-kanban" id="kanban"></div>
    <button id="addDealBtn" class="od-fab">+</button>
  </section>

  <!-- –°–¥–µ–ª–∫–∏ -->
  <section id="tab-deals" class="od-view">
    <div class="od-toolbar"><input id="dealSearch" class="od-input" placeholder="–ü–æ–∏—Å–∫ —Å–¥–µ–ª–∫–∏..."></div>
    <div id="dealList" class="od-list"></div>
  </section>

  <!-- –ö–ª–∏–µ–Ω—Ç—ã -->
  <section id="tab-clients" class="od-view">
    <div class="od-toolbar"><input id="clientSearch" class="od-input" placeholder="–ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞ (–∏–º—è/—Ç–µ–ª–µ—Ñ–æ–Ω/email/–≥–æ—Ä–æ–¥)..."></div>
    <div id="clientList" class="od-list"></div>
  </section>

  <!-- –û—Ç—á—ë—Ç—ã -->
  <section id="tab-reports" class="od-view">
    <div class="od-toolbar od-periods">
      <button class="od-btn od-period od-btn--primary" data-period="today">–°–µ–≥–æ–¥–Ω—è</button>
      <button class="od-btn od-period" data-period="7">7 –¥–Ω–µ–π</button>
      <button class="od-btn od-period" data-period="30">–ú–µ—Å—è—Ü</button>
      <button class="od-btn od-period" data-period="90">3 –º–µ—Å</button>
      <button class="od-btn od-period" data-period="180">6 –º–µ—Å</button>
    </div>
    <div class="od-cards">
      <div class="od-card"><div class="od-card-title">–°–¥–µ–ª–∫–∏</div><div id="r-count" class="od-kpi">0</div></div>
      <div class="od-card"><div class="od-card-title">–í—ã—Ä—É—á–∫–∞</div><div id="r-sum" class="od-kpi">0 ‚Ç∏</div></div>
      <div class="od-card"><div class="od-card-title">–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</div><div id="r-avg" class="od-kpi">0 ‚Ç∏</div></div>
    </div>
    <h3 class="od-h3">–ö–∞—á–µ—Å—Ç–≤–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤</h3>
    <div id="r-sources" class="od-quality"></div>
  </section>

  <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
  <section id="tab-settings" class="od-view">
    <h3 class="od-h3">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤</h3>
    <div class="od-toolbar"><input id="settingsClientSearch" class="od-input" placeholder="–ù–∞–π—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞ (–∏–º—è/—Ç–µ–ª–µ—Ñ–æ–Ω/email/–≥–æ—Ä–æ–¥)"></div>
    <div id="settingsClientList" class="od-list"></div>
  </section>
</main>

<!-- –î–∏–∞–ª–æ–≥ –Ω–æ–≤–æ–π —Å–¥–µ–ª–∫–∏ -->
<dialog id="dealDialog" class="od-dialog">
  <form id="dealForm" method="dialog" class="od-form">
    <h3>–ù–æ–≤–∞—è —Å–¥–µ–ª–∫–∞</h3>
    <label>–ö–ª–∏–µ–Ω—Ç<input id="dlgClient" class="od-input" required></label>
    <label>–¢–µ–ª–µ—Ñ–æ–Ω<input id="dlgPhone" class="od-input" inputmode="tel" placeholder="+7 700 000 00 00"></label>
    <label>–ë—é–¥–∂–µ—Ç (‚Ç∏)<input id="dlgBudget" class="od-input" inputmode="numeric"></label>
    <label>–ò—Å—Ç–æ—á–Ω–∏–∫
      <select id="dlgSource" class="od-input">
        <option>Instagram</option><option>WhatsApp</option><option>2–ì–ò–°</option>
        <option>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</option><option>–û–±—ä—è–≤–ª–µ–Ω–∏–µ</option><option>–í–∏–∑–∏—Ç –≤ –º–∞–≥–∞–∑–∏–Ω</option>
      </select>
    </label>
    <menu class="od-actions">
      <button id="dlgCancel" value="cancel" class="od-btn od-btn--ghost">–û—Ç–º–µ–Ω–∞</button>
      <button id="dlgSave"   value="default" class="od-btn od-btn--primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </menu>
  </form>
</dialog>

<!-- –î–∏–∞–ª–æ–≥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ -->
<dialog id="clientDialog" class="od-dialog">
  <form method="dialog" class="od-form">
    <h3>–ö–ª–∏–µ–Ω—Ç</h3>
    <input type="hidden" id="clId">
    <label>–ò–º—è<input id="clName" class="od-input" required></label>
    <label>–¢–µ–ª–µ—Ñ–æ–Ω<input id="clPhone" class="od-input" inputmode="tel"></label>
    <label>Email<input id="clEmail" class="od-input" inputmode="email"></label>
    <label>–ì–æ—Ä–æ–¥<input id="clCity" class="od-input"></label>
    <label>–ê–¥—Ä–µ—Å<input id="clAddress" class="od-input"></label>
    <label>–ò—Å—Ç–æ—á–Ω–∏–∫
      <select id="clSource" class="od-input">
        <option>Instagram</option><option>WhatsApp</option><option>2–ì–ò–°</option>
        <option>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</option><option>–û–±—ä—è–≤–ª–µ–Ω–∏–µ</option><option>–í–∏–∑–∏—Ç –≤ –º–∞–≥–∞–∑–∏–Ω</option>
      </select>
    </label>
    <label>–ó–∞–º–µ—Ç–∫–∞<textarea id="clNote" class="od-input" rows="3" placeholder="–ß—Ç–æ –≤–∞–∂–Ω–æ –ø–æ –∫–ª–∏–µ–Ω—Ç—É"></textarea></label>
    <menu class="od-actions">
      <button value="cancel" class="od-btn od-btn--ghost">–û—Ç–º–µ–Ω–∞</button>
      <button id="clSave" value="default" class="od-btn od-btn--primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </menu>
  </form>
</dialog>

<!-- –î–∏–∞–ª–æ–≥ –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞ (–ø—Ä–æ—Å–º–æ—Ç—Ä) -->
<dialog id="clientView" class="od-dialog">
  <div class="od-form">
    <h3 id="cvName">–ö–ª–∏–µ–Ω—Ç</h3>
    <p id="cvMeta" class="cv-meta"></p>
    <menu class="od-actions">
      <a id="cvWA" target="_blank" class="od-btn od-btn--primary">WhatsApp</a>
      <a id="cvCall" class="od-btn">–ü–æ–∑–≤–æ–Ω–∏—Ç—å</a>
      <button id="cvEdit" class="od-btn">–ò–∑–º–µ–Ω–∏—Ç—å</button>
      <button id="cvDelete" class="od-btn od-btn--ghost">–£–¥–∞–ª–∏—Ç—å</button>
      <button id="cvClose" class="od-btn od-btn--ghost">–ó–∞–∫—Ä—ã—Ç—å</button>
    </menu>
  </div>
</dialog>

<!-- –î–∏–∞–ª–æ–≥ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å–¥–µ–ª–∫–∏ (–ö–ü/–ù–∞–∫–ª–∞–¥–Ω–∞—è) -->
<dialog id="docsDialog" class="od-dialog">
  <form method="dialog" class="od-form" id="docsForm">
    <h3>–î–æ–∫—É–º–µ–Ω—Ç—ã —Å–¥–µ–ª–∫–∏</h3>
    <input type="hidden" id="docsDealId">
    <label>–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞
      <select id="docType" class="od-input">
        <option value="kp">–ö–ü</option>
        <option value="naklad">–ù–∞–∫–ª–∞–¥–Ω–∞—è</option>
      </select>
    </label>
    <label>–§–∞–π–ª (—Ñ–æ—Ç–æ/PDF)
      <input id="docFile" type="file" class="od-input" accept="image/*,.pdf">
    </label>
    <menu class="od-actions">
      <button id="docUpload" class="od-btn od-btn--primary">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
      <button value="cancel" class="od-btn od-btn--ghost">–ó–∞–∫—Ä—ã—Ç—å</button>
    </menu>
    <div id="docsList" class="od-list"></div>
  </form>
</dialog>

<script>
  // –í–∫–ª–∞–¥–∫–∏
  document.querySelectorAll(".od-tab").forEach(btn=>{
    btn.addEventListener("click",()=>{
      document.querySelectorAll(".od-tab").forEach(b=>b.classList.remove("od-tab--active"));
      document.querySelectorAll(".od-view").forEach(v=>v.classList.remove("od-view--active"));
      btn.classList.add("od-tab--active");
      document.getElementById("tab-"+btn.dataset.tab).classList.add("od-view--active");
    }, {passive:true});
  });
  // –¢–µ–º–∞
  const themeBtn=document.getElementById('themeBtn');
  themeBtn?.addEventListener('click',()=>{
    const t=document.documentElement.dataset.theme==='dark'?'light':'dark';
    document.documentElement.dataset.theme=t; localStorage.setItem('od_theme',t);
  }, {passive:true});
  document.documentElement.dataset.theme=localStorage.getItem('od_theme')||'dark';

  // –£–±–∏—Ä–∞–µ–º –¥–≤–æ–π–Ω–æ–π —Ç–∞–ø-–∑—É—É–º
  let lastTouch=0;
  document.addEventListener('touchend', (e)=>{
    const now = Date.now();
    if(now - lastTouch <= 300){ e.preventDefault(); }
    lastTouch = now;
  }, {passive:false});
  document.addEventListener('gesturestart', (e)=>e.preventDefault());
</script>
<script type="module" src="./app.js"></script>
</body>
</html>
